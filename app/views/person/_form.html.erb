<style>
    body{
        margin-top: 0px !important;
    }
</style>

<script>
	var barcode_scan_url = "/person/barcode_scan";

	function checkBarcode(id){
		var value = __$("touchscreenInput" + tstCurrentPage).value;

		if (value.match(/\$$/) && value.length > 1){
			value = value.replace("$", '');
			__$("touchscreenInput" + tstCurrentPage).value = value;

			jQuery.ajax({
				url: barcode_scan_url + "?value=" + value,
				success: function(result){

					data = JSON.parse(result);
					console.log('success');
					//console.log(data[0]);
				},
				error: function(){

					__$("touchscreenInput" + tstCurrentPage).value = "";
					showMessage("Something Went Wrong!");
				}
			})
		}

		setTimeout(function(){checkBarcode(id)}, 500);
	}


</script>

<%= form_for @person, :url => '/person/create', :method => :post do |f| %>

    <%= f.hidden_field :_rev rescue "" %>

    <input type="hidden" name="person[place_of_birth]" value="<%= Location.where(location_id: SETTINGS['location_id']).first.name  %>"/>
    <input type="hidden" name="person[hospital_of_birth]" value="<%= Location.current.name %>" />

    <input type="hidden" id="person_birth_district" name="person[birth_district]" value="<%=Location.find(Location.current.parent_location).name%>">
    <input id="person_relationship" name="person[relationship]" value="normal" type="hidden"/>
    <input id="person_original_surname" type="hidden"/>
    <input id="person_duplicate" name="person[duplicate]" type="hidden" />
    <input id="person_is_exact_duplicate" type="hidden" name="person[is_exact_duplicate]" >

    <section name="Child Details">
        <sub id="child_details" name="Child Details">
            <%= text_field_tag("person[first_name]", nil,
                               :id => "child_first_name",
                               :helpText => "First name"
                ) %>

            <%= text_field_tag("person[last_name]", nil,
                               :id => "child_last_name",
                               :helpText => "Last name"
                ) %>

            <%= text_field_tag("person[birthdate]", nil,
                               :id => "child_birthdate",
                               :field_type => "date",
                               :tt_onLoad => "__$('Unknown').style.display = 'none'",
                               :helpText => "Birthdate"
                ) %>

            <%= select_tag "person[gender]", options_for_select([ "Male", "Female" ], nil),
                           :id => "child_gender",
                           :helpText => "Gender"
            %>
        </sub>
        <sub id="child_birth_details" name="Child Birth Details">
            <%= text_field_tag("person[birth_weight]", nil,
                               :id => "person_birth_weight",
                               :field_type => "decimal",
                               :helpText => "Birth weight (in kilograms)",
                               :optional => true
                ) %>

            <%= select_tag "person[type_of_birth]", options_for_select([ "Single", "Twin", "Second Twin", "Triplet", "Second Triplet", "Third Triplet", "Other" ], nil),
                           :id => "person_type_of_birth",
                           :helpText => "Type of Birth"
            %>

            <%= select_tag "person[parents_married_to_each_other]", options_for_select([ "Yes", "No" ], nil),
                           :id => "person_parents_married_to_each_other",
                           :helpText => "Are the Parents Married to each Other?"
            %>

            <%= select_tag "person[court_order_attached]", options_for_select([ "Yes", "No" ], nil),
                           :id => "person_court_order_attached",
                           :helpText => "Court order attached?"
            %>

            <%= select_tag "person[parents_signed]", options_for_select([ "Yes", "No" ], nil),
                           :id => "person_parents_signed",
                           :helpText => "Parents signed?"
            %>
        </sub>
    </section>

    <section name="Mother Details">
        <sub id="mother_details" name="Mother Details">
            <%= text_field_tag(:mother_barcode, nil,
                               :id => "mother_barcode",
                               :optional => "true",
                               :helpText => "Scan mother barcode",
                               :tstPageStyleClass => "NoKeyboard",
                               :tt_onLoad => "__$('keyboard').style.display = 'none'; checkBarcode('mother_barcode')") %>

            <%= text_field_tag("person[mother][first_name]", nil,
                               :id => "mother_first_name",
                               :helpText => "Mother first name"
                ) %>

            <%= text_field_tag("person[mother][last_name]", nil,
                               :id => "mother_last_name",
                               :helpText => "Mother surname"
                ) %>

            <%= text_field_tag("person[mother][maiden_name]", nil,
                               :id => "mother_maiden_name",
                               :optional => true,
                               :helpText => "Mother maiden name"
                ) %>

            <%= text_field_tag("person[mother][birthdate]", nil,
                               :id => "mother_birthdate",
                               :field_type => "date",
                               :tt_onLoad => "__$('Unknown').style.display = 'none'",
                               :helpText => "Mother birthdate"
                ) %>

            <%= text_field_tag("person[mother][citizenship]", nil,
                               :id => "person_mother_citizenship",
                               :helpText => "Mother's Nationality",
                               :ajaxURL  => "/search_by_nationality"
                ) %>

            <%= text_field_tag("person[mother][residential_country]", nil,
                               :id => "person_mother_local_residential_country",
                               :helpText => "Mother's Country of Residence",
                               :ajaxURL  => "/search_by_country"
                ) %>

        </sub>

        <sub id="mother_home_address" name="Mother Home Address">
            <%= text_field_tag("person[mother][home_district]", nil,
                               :id => "person_mother_home_district",
                               :helpText => "Mother Home District",
                               :ajaxURL  => "/search_by_district",
                               :tt_onUnload =>"__$('person_mother_home_ta').setAttribute('ajaxURL','/search_by_ta?district='+__$('touchscreenInput' + tstCurrentPage).value)"
                ) %>

            <%= text_field_tag("person[mother][home_ta]", nil,
                               :id => "person_mother_home_ta",
                               :helpText => "Mother Home T/A or Area of Residence",
                               :tt_onUnload =>"__$('person_mother_home_village').setAttribute('ajaxURL','/search_by_village?ta='+__$('touchscreenInput' + tstCurrentPage).value+'&district='+__$('person_mother_home_district').value)"
                ) %>

            <%= text_field_tag("person[mother][home_village]", nil,
                               :id => "person_mother_home_village",
                               :helpText => "Mother Home Village/Town",
                               :ajaxURL  => "/search_by_village"
                ) %>
        </sub>

        <sub id="mother_physical_address" name="Mother Physical Address">
            <%= text_field_tag("person[mother][current_district]", nil,
                               :id => "person_mother_current_district",
                               :helpText => "Mother Current District",
                               :ajaxURL  => "/search_by_district",
                               :tt_onUnload =>"__$('person_mother_current_ta').setAttribute('ajaxURL','/search_by_ta?district='+__$('touchscreenInput' + tstCurrentPage).value)"
                ) %>

            <%= text_field_tag("person[mother][current_ta]", nil,
                               :id => "person_mother_current_ta",
                               :helpText => "Mother Current T/A or Area of Residence",
                               :tt_onUnload =>"__$('person_mother_current_village').setAttribute('ajaxURL','/search_by_village?ta='+__$('touchscreenInput' + tstCurrentPage).value+'&district='+__$('person_mother_current_district').value)"


                ) %>

            <%= text_field_tag("person[mother][current_village]", nil,
                               :id => "person_mother_current_village",
                               :helpText => "Mother Current Village/Town",
                               :ajaxURL  => "/search_by_village"
                ) %>
        </sub>

        <sub id="mother_birth_details" name="Mother Birth Details">
            <%= text_field_tag("gestation_at_birth", nil,
                               :id => "person_gestation_at_birth",
                               :helpText => "Gestation age at birth in weeks",
                               :optional => true
                ) %>

            <%= text_field_tag("number_of_prenatal_visits", nil,
                               :id => "person_number_of_prenatal_visits",
                               :helpText => "Number of prenatal visits",
                               :optional => true
                ) %>

            <%= text_field_tag("month_prenatal_care_started", nil,
                               :id => "person_month_prenatal_care_started",
                               :helpText => "Month of pregnancy prenatal care started",
                               :optional => true
                ) %>

            <%= select_tag "person[mode_of_delivery]", options_for_select([ "SVD", "Vaccum Extraction", "Breech",
                                                                            "Forceps", "Caesarean Section" ], nil),
                           :id => "person_mode_of_delivery",
                           :helpText => "Mode of Delivery"
            %>

            <%= text_field_tag("number_of_children_born_alive_inclusive", nil,
                               :id => "person_number_of_children_born_alive_inclusive",
                               :helpText => "Number of children born to mother, including this child"
                ) %>

            <%= text_field_tag("number_of_children_born_still_alive", nil,
                               :id => "person_number_of_children_born_still_alive",
                               :helpText => "Number of children born to mother, and still living"
                ) %>

            <%= select_tag "person[level_of_education]", options_for_select([ "None", "Primary", "Secondary",
                                                                              "Higher Education" ], nil),
                           :id => "person_level_of_education",
                           :helpText => "Completed level of education"
            %>

        </sub>

    </section>

    <section name="Father Details">
        <sub id="father_details" name="Father Details">
            <%= text_field_tag(:father_barcode, nil,
                               :id => "father_barcode",
                               :optional => "true",
                               :helpText => "Scan father barcode",
                               :tstPageStyleClass => "NoKeyboard",
                               :tt_onLoad => "__$('keyboard').style.display = 'none'; checkBarcode('mother_barcode')") %>

            <%= text_field_tag("person[father][first_name]", nil,
                               :id => "father_first_name",
                               :helpText => "Father first name"
                ) %>

            <%= text_field_tag("person[father][last_name]", nil,
                               :id => "father_last_name",
                               :helpText => "Father surname"
                ) %>

            <%= text_field_tag("person[father][maiden_name]", nil,
                               :id => "father_maiden_name",
                               :optional => true,
                               :helpText => "Father maiden name"
                ) %>

            <%= text_field_tag("person[father][birthdate]", nil,
                               :id => "father_birthdate",
                               :field_type => "date",
                               :tt_onLoad => "__$('Unknown').style.display = 'none'",
                               :helpText => "Father birthdate"
                ) %>

            <%= text_field_tag("person[father][citizenship]", nil,
                               :id => "person_father_citizenship",
                               :helpText => "Father's Nationality",
                               :ajaxURL  => "/search_by_nationality"
                ) %>

            <%= text_field_tag("person[father][residential_country]", nil,
                               :id => "person_father_local_residential_country",
                               :helpText => "Father's Country of Residence",
                               :ajaxURL  => "/search_by_country"
                ) %>

        </sub>

        <sub id="father_home_address" name="Father Home Address">
            <%= text_field_tag("person[father][home_district]", nil,
                               :id => "person_father_home_district",
                               :helpText => "Father Home District",
                               :ajaxURL  => "/search_by_district",
                               :tt_onUnload =>"__$('person_father_home_ta').setAttribute('ajaxURL','/search_by_ta?district='+__$('touchscreenInput' + tstCurrentPage).value)"
                ) %>

            <%= text_field_tag("person[father][home_ta]", nil,
                               :id => "person_father_home_ta",
                               :helpText => "Father Home T/A or Area of Residence",
                               :tt_onUnload =>"__$('person_father_home_village').setAttribute('ajaxURL','/search_by_village?ta='+__$('touchscreenInput' + tstCurrentPage).value+'&district='+__$('person_father_home_district').value)"
                ) %>

            <%= text_field_tag("person[father][home_village]", nil,
                               :id => "person_father_home_village",
                               :helpText => "Father Home Village/Town",
                               :ajaxURL  => "/search_by_village"
                ) %>
        </sub>

        <sub id="father_physical_address" name="Father Physical Address">
            <%= text_field_tag("person[father][current_district]", nil,
                               :id => "person_father_current_district",
                               :helpText => "Father Current District",
                               :ajaxURL  => "/search_by_district",
                               :tt_onUnload =>"__$('person_father_current_ta').setAttribute('ajaxURL','/search_by_ta?district='+__$('touchscreenInput' + tstCurrentPage).value)"
                ) %>

            <%= text_field_tag("person[father][current_ta]", nil,
                               :id => "person_father_current_ta",
                               :helpText => "Father Current T/A or Area of Residence",
                               :tt_onUnload =>"__$('person_father_current_village').setAttribute('ajaxURL','/search_by_village?ta='+__$('touchscreenInput' + tstCurrentPage).value+'&district='+__$('person_father_current_district').value)"


                ) %>

            <%= text_field_tag("person[father][current_village]", nil,
                               :id => "person_father_current_village",
                               :helpText => "Father Current Village/Town",
                               :ajaxURL  => "/search_by_village"
                ) %>
        </sub>
    </section>

    <section name="Informant Details">
        <sub id="informant_details" name="Informant Details">
            <%= select_tag "informant_same_as_mother", options_for_select([ "Yes", "No" ], nil),
                           :id => "informant_same_as_mother",
                           :helpText => "Mother is informant?"
            %>
            <%= select_tag "informant_same_as_father", options_for_select([ "Yes", "No" ], nil),
                           :id => "informant_same_as_father",
                           :helpText => "Father is informant?"
            %>

            <%= text_field_tag("person[informant][first_name]", nil,
                               :id => "informant_first_name",
                               :helpText => "Informant first name"
                ) %>

            <%= text_field_tag("person[informant][last_name]", nil,
                               :id => "informant_last_name",
                               :helpText => "Informant surname"
                ) %>

            <%= text_field_tag("person[informant][birthdate]", nil,
                               :id => "informant_birthdate",
                               :field_type => "date",
                               :tt_onLoad => "__$('Unknown').style.display = 'none'",
                               :helpText => "Informant birthdate"
                ) %>

            <%= text_field_tag("person[informant][citizenship]", nil,
                               :id => "person_informant_citizenship",
                               :helpText => "Informant's Nationality",
                               :ajaxURL  => "/search_by_nationality"
                ) %>

            <%= text_field_tag("person[informant][residential_country]", nil,
                               :id => "person_informant_local_residential_country",
                               :helpText => "Informant's Country of Residence",
                               :ajaxURL  => "/search_by_country"
                ) %>
        </sub>
        <sub id="informant_relationship_details" name="Informant Relationship Details">
            <%= select_tag "person[informant][relationship_to_person]", options_for_select([ 'Grandmother/Grandfather',
                                                                                             'Brother/Sister', 'Aunt/Uncle',
                                                                                             'Mother-in-law/Father-in-law',
                                                                                             'Sister-in-marriage/Brother-in-marriage',
                                                                                             'Other'], nil),
                           :id => "person_informant_relationship_to_person",
                           :helpText => "Informant relationship to person"
            %>
            <%= text_field_tag("person[informant][other_informant_relationship_to_person]", nil,
                               :id => "other_informant_relationship_to_person",
                               :helpText => "Specifiy informant relationship",
                ) %>
        </sub>
        <sub id="informant_home_address" name="Informant Home Address">
            <%= text_field_tag("person[informant][home_district]", nil,
                               :id => "person_informant_home_district",
                               :helpText => "Informant Home District",
                               :ajaxURL  => "/search_by_district",
                               :tt_onUnload =>"__$('person_informant_home_ta').setAttribute('ajaxURL','/search_by_ta?district='+__$('touchscreenInput' + tstCurrentPage).value)"
                ) %>

            <%= text_field_tag("person[informant][home_ta]", nil,
                               :id => "person_informant_home_ta",
                               :helpText => "Informant Home T/A or Area of Residence",
                               :tt_onUnload =>"__$('person_informant_home_village').setAttribute('ajaxURL','/search_by_village?ta='+__$('touchscreenInput' + tstCurrentPage).value+'&district='+__$('person_informant_home_district').value)"
                ) %>

            <%= text_field_tag("person[informant][home_village]", nil,
                               :id => "person_informant_home_village",
                               :helpText => "Informant Home Village/Town",
                               :ajaxURL  => "/search_by_village"
                ) %>
        </sub>

        <sub id="informant_physical_address" name="Informant Physical Address">
            <%= text_field_tag("person[informant][current_district]", nil,
                               :id => "person_informant_current_district",
                               :helpText => "Informant Current District",
                               :ajaxURL  => "/search_by_district",
                               :tt_onUnload =>"__$('person_informant_current_ta').setAttribute('ajaxURL','/search_by_ta?district='+__$('touchscreenInput' + tstCurrentPage).value)"
                ) %>

            <%= text_field_tag("person[informant][current_ta]", nil,
                               :id => "person_informant_current_ta",
                               :helpText => "Informant Current T/A or Area of Residence",
                               :tt_onUnload =>"__$('person_informant_current_village').setAttribute('ajaxURL','/search_by_village?ta='+__$('touchscreenInput' + tstCurrentPage).value+'&district='+__$('person_informant_current_district').value)"


                ) %>

            <%= text_field_tag("person[informant][current_village]", nil,
                               :id => "person_informant_current_village",
                               :helpText => "Informant Current Village/Town",
                               :ajaxURL  => "/search_by_village"
                ) %>
        </sub>
        <sub id="informant_extra_details" name="Informant Extra Details">
            <%= text_field_tag("person[informant][phone_number]", nil,
                               :id => "person_informant_phone_number",
                               :helpText => "Please enter a valid phone number"
                ) %>
            <%= select_tag "person[form_signed]", options_for_select([ "Yes", "No" ], nil),
                           :id => "form_signed",
                           :helpText => "Has the form been signed by the Informant?"
            %>
            <%= text_field_tag("date_reported", nil,
                               :id => "informant_report_date",
                               :field_type => "date",
                               :tt_onLoad => "__$('Unknown').style.display = 'none'",
                               :helpText => "Date of Reporting"
                ) %>
            <%= select_tag "copy_mother_name", options_for_select([ "Yes", "No" ], nil),
                           :id => "person_copy_mother_name",
                           :helpText => "Replace person Surname with Mother Maiden Surname?"
            %>
        </sub>
    </section>
<% end %>

<script>

</script>
